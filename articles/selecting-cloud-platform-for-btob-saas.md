---
title: "法人向けクラウドサービスのインフラ(ホスティング・データベース・認証・サーバレスアーキテクチャ)選定"
emoji: "🌊"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["AWS", "Firebase", "サーバレス", "IDaaS", "BtoB"]
published: false
---

# 概要

結論として ★★ の理由で ★★ のサービスを選定しました。

## きっかけ

現在は私は法人向けの クラウドサービス(BtoB SaaS) を開発しようとしており、認証機能について無料枠の大きい Firebase Authentication を採用しようとしていました。
しかし、Firebase Authentication で SAML を利用する場合無料枠が制限されるとの記載を Firebase 上で見かけました。

![Firebase AuthenticationでSAMLを利用する場合の無料枠制限](/images/selecting-authentication-service-for-btob-saas/firebasePlan.png)

そのため、どうせ制限を受けるのであれば Firebase Authentication 以外のサービスも含めて比較しようと考えました。
以下ではホスティング・データベース・認証の 3 要素をそれぞれ選定した後、その内容を元にサーバレスアーキテクチャを選定します。
できるだけサーバレスにしたい理由は、開発するサービスの収益がどの程度となるかわからないため費用を抑えたいことと
開発者は私一人となるため運用周りの作業をできるだけ減らしたいためです。

# ホスティングサービスの選定

## 参考資料

https://zenn.dev/catnose99/scraps/6780379210136f

https://zenn.dev/knagano/scraps/d772707b4909b0

## 選定基準

以下を選定基準としました。上から順に優先順位が高いです。

- 費用が抑えられるか
- 開発の初心者でも簡単にデプロイできるか
- サーバレスアーキテクチャとの親和性が高いか

## 選定候補

他にもホスティングサービスはありますが、プログラミングの学習の過程で操作したものや人から良いと言われて試したみたサービスのみを選んでいます。

- [Vercel](https://vercel.com/dashboard)
- [Firebase Hosting](https://firebase.google.com/docs/hosting?hl=ja)
- [AWS Amplify ホスティング](https://aws.amazon.com/jp/amplify/)

## 選定結果

結論としては下記となります。

- サーバレスアーキテクチャとして Firebase を採用した場合は Firebase Hosting
- AWS Amplify を選んだ場合は AWS Amplify ホスティング

以下、各選定基準に沿った説明を行います。

### 費用を抑えられるか

以下の観点から、無料枠で費用が抑えられる Firebase Hosting 及び AWS Amplify が残ります。

|                  | [Vercel 料金](https://vercel.com/pricing) | [Firebase Hosting 料金](https://firebase.google.com/pricing?hl=ja#hosting) | [AWS Amplify ホスティング料金](https://aws.amazon.com/jp/amplify/pricing/?nc=sn&loc=4) |
| ---------------- | ----------------------------------------- | -------------------------------------------------------------------------- | -------------------------------------------------------------------------------------- |
| 無料プラン       | 商用利用不可                              | ストレージ 10 GB<br>データ転送 360 MB/日                                   | 15 GB のホスティングサービス/月など                                                    |
| 最小の有料プラン | $20<br>1 ユーザ / 月                      | ストレージ $0.026/GB<br>データ転送 $0.15/GB                                | ホスティングサービス<br>1 GB あたり$0.15 など                                          |

### 開発の初心者でも簡単にデプロイできるか

法人向けクラウドサービスがどんどん出てきて市場が盛り上がってほしいため、経験が少ない人にも勧められるサービスを自分でも使っていきます。

使い勝手について 3 サービスとも使ってみた結果、特に詰まることなくデプロイができたため同列という結論です。
ただ、Vercel でデプロイできていた React のプログラムが AWS Amplify ではできなかったこともありました。
そのため、多少作りがまずいものでもデプロイできるという点では Vercel が少し優れているという感触です。

### サーバレスアーキテクチャとの親和性が高いか

ホスティングは特にサーバレスアーキテクチャとの関係が密接であるため、重視したいポイントです。
各ホスティングサービスは、そのサービスが内包されるサーバレスアーキテクチャと親和性が高いため、
Firebase というサーバレスアーキテクチャとして採用した場合は Firebase Hosting を、AWS Amplify を選んだ場合は AWS Amplify ホスティングを選ぶことになります。

サーバレスアーキテクチャはこの後決めるため、ここではどのホスティングサービスを使うかは決まらないということになります。

# データベースの選定

## 参考資料

https://zenn.dev/nyarla/scraps/326424edf5d2eb

https://blog.kon-shou.com/posts/20200519/

## SQL か NoSQL か

NoSQL の個人的な最大のメリットは、フロントエンドから直接 DB にアクセスできるためバックエンドの開発や学習を行わないで良い点です。(技術的な理解が間違っていればご指摘ください。。。)

## 選定基準

以下を選定基準としました。上から順に優先順位が高いです。

- 費用が抑えられるか
- フロントエンドから呼び出しやすいか

## 選定候補

ここでも、実際に自分で試したみたサービスのみを選んでいます。

- [Cloud Firestore](https://firebase.google.com/docs/firestore)
- [Amazon DynamoDB](https://aws.amazon.com/jp/dynamodb/)

## 選定結果

<!-- ★ 以下を参考に Amazon DynamoDB を試してみる
https://blog.usize-tech.com/dynamodb-usertable-for-react-app/ -->

### 費用が抑えられるか

### フロントエンドから呼び出しやすいか

# 認証サービスの選定

## 参考資料

Web 検索ではあまり情報が出てこないため、情報がまとまっていそうな以下の書籍の情報をベースに必要に応じて各サービスのサイトを参照するようにします。

https://techbookfest.org/product/6354233804718080?productVariantID=5804352044269568

## 選定基準

以下を選定基準としました。上から順に優先順位が高いです。

- 海外法令の影響を受けないように認証に使用する個人情報を日本国内に配置できるか
- セキュリティと利便性の観点から OIDC が使えるか
- 情報を保護するため多要素認証(MFA)が行えるか
- どの程度の収益となるかが開発開始時点では読めないため、できるだけ費用を抑えられるか
- 攻撃を受けた際に顧客情報の保護やサービスの継続稼働を行うための対策機能を備えているか
- Azure AD からのプロビジョニングが行えるか（設立予定の法人で Azure AD を使用する予定であるため）

## 選定候補

参考資料の書籍に載っていたサービスを対象とします。

## 選定結果

### 認証に使用する個人情報を日本国内に配置できるか

### OIDC でのログインが行えるか

### 多要素認証(MFA)が行えるか

<!-- 2FAではなくMFA -->

### 費用を抑えられるか

### 攻撃への対策機能を備えているか

### Azure AD からのプロビジョニングが行えるか

# サーバレスアーキテクチャの選定

自己資金であるため、費用を抑えるためにサーバレスを活用します。

## 参考資料

https://qiita.com/h1guchi/items/4c4fc1b11580b76409b9

https://qiita.com/toto_inu/items/77e31e92f908a1fda8f7

## 選定基準

★ 認証も悩んでるけど、諸々を Firebase でいくか AWS でいくかをまだ悩んでる。
なんとなく AWS に傾いてきてるけど、構成がいまいち決まりきらないから費用の不安が拭えない。

- 方針 1.最初 Firebase でやって、スケールしたら AWS に切り替える

  - スケールしたときに切り替えるのが地獄そう

- 方針 2.最初から AWS でいく
  - 費用を抑える方法を探したとしても、個人資金の範囲で収まるかどうか
